---
name: wp-blocks
description: Use when building Gutenberg blocks, block themes, or using the Interactivity API â€” block.json, static and dynamic rendering, InnerBlocks, deprecations, theme.json, templates, patterns, data-wp-* directives, server-side rendering, WordPress 6.9 features.
---

# WP Blocks, Block Themes, and Interactivity API

Consolidated skill for WordPress Gutenberg block development, block theme creation, and the Interactivity API. Targets WordPress 6.9+ (PHP 7.2.24+).

---

## Part 1: Block Development

### 1.1 block.json Metadata

Every block starts with a `block.json` file. WordPress 6.9 enforces **apiVersion 3**.

```json
{
  "$schema": "https://schemas.wp.org/trunk/block.json",
  "apiVersion": 3,
  "name": "my-plugin/my-block",
  "version": "1.0.0",
  "title": "My Block",
  "category": "widgets",
  "icon": "smiley",
  "description": "A custom block.",
  "supports": {
    "html": false,
    "color": { "background": true, "text": true },
    "typography": { "fontSize": true },
    "spacing": { "margin": true, "padding": true }
  },
  "attributes": {
    "content": { "type": "string", "source": "html", "selector": "p" },
    "alignment": { "type": "string", "default": "none" }
  },
  "textdomain": "my-plugin",
  "editorScript": "file:./index.js",
  "editorStyle": "file:./index.css",
  "style": "file:./style-index.css",
  "render": "file:./render.php",
  "viewScriptModule": "file:./view.js"
}
```

**Required fields:** `apiVersion`, `name`, `title`.

**Asset fields:**

| Field              | Loads in       | Purpose                              |
|--------------------|----------------|--------------------------------------|
| `editorScript`     | Editor only    | Block registration and edit UI       |
| `editorStyle`      | Editor only    | Editor-specific styles               |
| `script`           | Both           | Shared JS (editor + frontend)        |
| `style`            | Both           | Shared styles                        |
| `viewScript`       | Frontend only  | Classic frontend script              |
| `viewScriptModule` | Frontend only  | Module-based frontend script (ES)    |
| `viewStyle`        | Frontend only  | Frontend-only styles                 |
| `render`           | Server         | PHP render file for dynamic blocks   |

**apiVersion 3 migration:**
1. Set `"apiVersion": 3` in block.json.
2. Declare all style handles in block.json (missing handles will not load in the iframed editor).
3. Test third-party scripts (window scoping differs in the iframe).
4. WordPress 7.0 will always use the iframe editor regardless of apiVersion.

### 1.2 Scaffolding with @wordpress/create-block

```bash
# Standard block
npx @wordpress/create-block my-block

# Dynamic block with render.php
npx @wordpress/create-block my-block --variant dynamic

# Interactive block (Interactivity API + viewScriptModule)
npx @wordpress/create-block my-block --template @wordpress/create-block-interactive-template
```

For manual setup without Node tooling:
1. Create a plugin directory with a valid `block.json`.
2. Register via `register_block_type_from_metadata()` in PHP.
3. Add editor JS and optional frontend view assets.

### 1.3 Static vs Dynamic Rendering

**Static blocks** save markup into post content via `save()`:
- Use when the output is self-contained HTML that does not depend on server state.
- Markup is stored in the database; changing `save()` output without a deprecation entry causes "Invalid block" errors.

**Dynamic blocks** render on the server via `render.php` or `render_callback`:
- Use when output depends on server data (recent posts, user info, external APIs).
- Use when output must always reflect current state.
- Set `save()` to return `null` (or minimal fallback markup).

### 1.4 edit.js + save.js Pattern

```jsx
// edit.js
import { useBlockProps, RichText } from '@wordpress/block-editor';

export default function Edit( { attributes, setAttributes } ) {
    const blockProps = useBlockProps();
    return (
        <div { ...blockProps }>
            <RichText
                tagName="p"
                value={ attributes.content }
                onChange={ ( content ) => setAttributes( { content } ) }
                placeholder="Enter text..."
            />
        </div>
    );
}
```

```jsx
// save.js
import { useBlockProps, RichText } from '@wordpress/block-editor';

export default function Save( { attributes } ) {
    const blockProps = useBlockProps.save();
    return (
        <div { ...blockProps }>
            <RichText.Content tagName="p" value={ attributes.content } />
        </div>
    );
}
```

### 1.5 useBlockProps() and get_block_wrapper_attributes()

These are **required** for the block wrapper element. They inject classes, styles, and data attributes generated by block supports.

| Context               | Function                              |
|-----------------------|---------------------------------------|
| Editor (`edit.js`)    | `useBlockProps()`                     |
| Static save (`save.js`) | `useBlockProps.save()`             |
| Dynamic render (PHP)  | `get_block_wrapper_attributes()`      |

**Dynamic render example (render.php):**

```php
<?php
$wrapper = get_block_wrapper_attributes( array( 'class' => 'my-custom-class' ) );
?>
<div <?php echo $wrapper; ?>>
    <p><?php echo esc_html( $attributes['content'] ); ?></p>
</div>
```

### 1.6 Attributes and Serialization

Attributes persist via:
- **Comment delimiter JSON** (default, most common and stable)
- **HTML source** (parsed from saved markup using `source` + `selector`)
- **Context** (from parent blocks)

**Source types:**

| Source      | Description                                    | Example                                            |
|-------------|------------------------------------------------|----------------------------------------------------|
| (none)      | Stored in block comment delimiter              | `{ "type": "string" }`                             |
| `attribute` | Parsed from an HTML attribute                  | `{ "source": "attribute", "selector": "img", "attribute": "src" }` |
| `text`      | Parsed from element text content               | `{ "source": "text", "selector": ".title" }`       |
| `html`      | Parsed from element inner HTML                 | `{ "source": "html", "selector": "p" }`            |
| `query`     | Extracts an array from repeated elements       | `{ "source": "query", "selector": "li", "query": { ... } }` |

**Rules:**
- Avoid the deprecated `meta` attribute source.
- Avoid brittle selectors that break when markup changes slightly.
- Changing saved HTML without a `deprecated` entry breaks existing posts.

### 1.7 InnerBlocks Composition

For container blocks that nest other blocks:

```jsx
// edit.js
import { useBlockProps, useInnerBlocksProps } from '@wordpress/block-editor';

export default function Edit() {
    const blockProps = useBlockProps();
    const innerBlocksProps = useInnerBlocksProps( blockProps, {
        allowedBlocks: [ 'core/paragraph', 'core/image', 'core/heading' ],
        template: [
            [ 'core/heading', { level: 2, placeholder: 'Title' } ],
            [ 'core/paragraph', { placeholder: 'Content...' } ],
        ],
        templateLock: false, // false | 'all' | 'insert' | 'contentOnly'
    } );

    return <div { ...innerBlocksProps } />;
}
```

```jsx
// save.js
import { useBlockProps, useInnerBlocksProps } from '@wordpress/block-editor';

export default function Save() {
    const blockProps = useBlockProps.save();
    const innerBlocksProps = useInnerBlocksProps.save( blockProps );
    return <div { ...innerBlocksProps } />;
}
```

**Rules:**
- Only one `InnerBlocks` instance per block.
- Use `templateLock` intentionally -- too strict is frustrating.
- Changing wrapper structure around inner blocks can invalidate existing content; add deprecations.

### 1.8 Block Supports

Declare supports in `block.json` to opt into editor UI controls:

```json
{
  "supports": {
    "color": {
      "background": true,
      "text": true,
      "gradients": true,
      "link": true
    },
    "typography": {
      "fontSize": true,
      "lineHeight": true,
      "fontFamily": true
    },
    "spacing": {
      "margin": true,
      "padding": true,
      "blockGap": true
    },
    "border": {
      "color": true,
      "radius": true,
      "style": true,
      "width": true
    },
    "align": true,
    "anchor": true,
    "html": false,
    "interactivity": true
  }
}
```

Support-generated classes and inline styles are applied automatically through `useBlockProps()` / `get_block_wrapper_attributes()`.

### 1.9 Block Variations

Variations create alternate configurations of an existing block:

```js
import { registerBlockVariation } from '@wordpress/blocks';

registerBlockVariation( 'core/embed', {
    name: 'youtube',
    title: 'YouTube',
    icon: 'youtube',
    attributes: { providerNameSlug: 'youtube' },
    isActive: ( blockAttributes ) =>
        blockAttributes.providerNameSlug === 'youtube',
} );
```

### 1.10 Block Styles

Register visual style variants (minimal usage recommended):

```js
import { registerBlockStyle } from '@wordpress/blocks';

registerBlockStyle( 'core/quote', {
    name: 'fancy',
    label: 'Fancy',
} );
```

This adds an `is-style-fancy` class. Define the CSS in your stylesheet. Avoid creating too many custom styles -- prefer block supports where possible.

### 1.11 Block Deprecations and Migrations

**Critical for preventing "Invalid block" errors.** When you change `save()` output or attribute shapes, you must add a deprecation entry.

```js
// index.js
import { registerBlockType } from '@wordpress/blocks';
import metadata from './block.json';

const deprecated = [
    {
        // Version 1: old save output
        attributes: {
            content: { type: 'string', source: 'html', selector: 'p' },
        },
        save( { attributes } ) {
            return <p>{ attributes.content }</p>;
        },
        migrate( attributes ) {
            // Transform old attributes to new shape if needed
            return {
                ...attributes,
                alignment: 'none',
            };
        },
    },
];

registerBlockType( metadata.name, {
    edit: Edit,
    save: Save,
    deprecated,
} );
```

**Rules:**
- Order: newest deprecated first, oldest last.
- Each entry needs `save` matching the old output.
- `migrate` is optional; use it to transform attributes.
- **Never change `save()` output without adding a deprecation entry.**
- Keep fixture content for each deprecated version to test migrations.

### 1.12 Registration (PHP)

Prefer metadata-based registration:

```php
// Plugin: register on init
add_action( 'init', function() {
    register_block_type_from_metadata( __DIR__ . '/build/blocks/my-block' );
} );
```

For dynamic blocks with a separate render callback:

```php
register_block_type_from_metadata(
    __DIR__ . '/build/blocks/my-block',
    array(
        'render_callback' => 'my_plugin_render_block',
    )
);
```

---

## Part 2: Block Themes

### 2.1 Theme Structure

Minimum viable block theme:

```
my-theme/
  style.css          # Theme header (required)
  theme.json         # Global settings and styles
  templates/
    index.html       # Minimum required template
    single.html
    page.html
    archive.html
    404.html
  parts/
    header.html
    footer.html
  patterns/
    hero.php
  styles/
    dark.json        # Style variation
```

### 2.2 theme.json Structure

```json
{
  "$schema": "https://schemas.wp.org/trunk/theme.json",
  "version": 3,
  "settings": {
    "color": {
      "palette": [
        { "slug": "primary", "color": "#1a1a2e", "name": "Primary" },
        { "slug": "secondary", "color": "#16213e", "name": "Secondary" },
        { "slug": "accent", "color": "#e94560", "name": "Accent" }
      ],
      "gradients": [],
      "custom": false,
      "defaultPalette": false
    },
    "typography": {
      "fontFamilies": [
        {
          "fontFamily": "-apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif",
          "slug": "system",
          "name": "System"
        }
      ],
      "fontSizes": [
        { "slug": "small", "size": "0.875rem", "name": "Small" },
        { "slug": "medium", "size": "1rem", "name": "Medium" },
        { "slug": "large", "size": "1.5rem", "name": "Large" },
        { "slug": "x-large", "size": "2.25rem", "name": "Extra Large" }
      ],
      "lineHeight": true
    },
    "spacing": {
      "units": [ "px", "em", "rem", "vh", "vw", "%" ],
      "spacingSizes": [
        { "slug": "10", "size": "0.5rem", "name": "Small" },
        { "slug": "20", "size": "1rem", "name": "Medium" },
        { "slug": "30", "size": "1.5rem", "name": "Large" },
        { "slug": "40", "size": "2rem", "name": "Extra Large" }
      ]
    },
    "layout": {
      "contentSize": "720px",
      "wideSize": "1200px"
    },
    "border": {
      "color": true,
      "radius": true,
      "style": true,
      "width": true,
      "radiusSizes": [
        { "name": "Small", "slug": "small", "size": "4px" },
        { "name": "Medium", "slug": "medium", "size": "8px" },
        { "name": "Large", "slug": "large", "size": "16px" }
      ]
    }
  },
  "styles": {
    "color": {
      "background": "var(--wp--preset--color--primary)",
      "text": "#ffffff"
    },
    "typography": {
      "fontFamily": "var(--wp--preset--font-family--system)",
      "fontSize": "var(--wp--preset--font-size--medium)",
      "lineHeight": "1.6"
    },
    "spacing": {
      "blockGap": "1.5rem"
    },
    "elements": {
      "link": {
        "color": { "text": "var(--wp--preset--color--accent)" }
      },
      "heading": {
        "typography": { "fontWeight": "700" }
      },
      "button": {
        "color": {
          "background": "var(--wp--preset--color--accent)",
          "text": "#ffffff"
        },
        ":hover": {
          "color": { "background": "#d63851" }
        },
        ":focus": {
          "color": { "background": "#d63851" }
        }
      },
      "input": {
        "border": { "color": "#cccccc", "width": "1px", "radius": "4px" },
        "spacing": { "padding": { "top": "8px", "bottom": "8px", "left": "12px", "right": "12px" } }
      }
    },
    "blocks": {
      "core/paragraph": {
        "typography": { "lineHeight": "1.8" }
      },
      "core/heading": {
        "spacing": { "margin": { "top": "2rem", "bottom": "1rem" } }
      }
    }
  },
  "customTemplates": [
    { "name": "blank", "title": "Blank", "postTypes": [ "page" ] }
  ],
  "templateParts": [
    { "name": "header", "title": "Header", "area": "header" },
    { "name": "footer", "title": "Footer", "area": "footer" },
    { "name": "sidebar", "title": "Sidebar", "area": "uncategorized" }
  ]
}
```

**Style hierarchy:** core defaults -> theme.json -> child theme -> user customizations. User customizations stored in the database can override theme.json edits (styles appear "ignored").

### 2.3 Per-Block Styles

Style individual blocks in the `styles.blocks` section of theme.json (shown above). Reference presets with `var(--wp--preset--<type>--<slug>)`.

### 2.4 Templates

Templates use block markup in HTML files under `templates/`:

```html
<!-- templates/single.html -->
<!-- wp:template-part {"slug":"header","area":"header"} /-->

<!-- wp:group {"tagName":"main","layout":{"type":"constrained"}} -->
<main class="wp-block-group">
    <!-- wp:post-title {"level":1} /-->
    <!-- wp:post-featured-image /-->
    <!-- wp:post-content {"layout":{"type":"constrained"}} /-->
    <!-- wp:post-terms {"term":"category"} /-->
</main>
<!-- /wp:group -->

<!-- wp:template-part {"slug":"footer","area":"footer"} /-->
```

### 2.5 Template Parts

Template parts live in `parts/` (not nested in subdirectories):

```html
<!-- parts/header.html -->
<!-- wp:group {"tagName":"header","layout":{"type":"constrained"}} -->
<header class="wp-block-group">
    <!-- wp:site-title /-->
    <!-- wp:navigation /-->
</header>
<!-- /wp:group -->
```

```html
<!-- parts/footer.html -->
<!-- wp:group {"tagName":"footer","layout":{"type":"constrained"}} -->
<footer class="wp-block-group">
    <!-- wp:paragraph {"align":"center"} -->
    <p class="has-text-align-center">Built with WordPress</p>
    <!-- /wp:paragraph -->
</footer>
<!-- /wp:group -->
```

### 2.6 Patterns

Filesystem patterns in `patterns/*.php` are auto-registered via file-level docblock:

```php
<?php
/**
 * Title: Hero Section
 * Slug: my-theme/hero
 * Categories: featured
 * Keywords: hero, banner, header
 * Block Types: core/template-part/header
 * Post Types: page
 * Viewport Width: 1200
 */
?>
<!-- wp:cover {"overlayColor":"primary","minHeight":500,"align":"full"} -->
<div class="wp-block-cover alignfull" style="min-height:500px">
    <span class="wp-block-cover__background has-primary-background-color has-background-dim-100 has-background-dim"></span>
    <div class="wp-block-cover__inner-container">
        <!-- wp:heading {"textAlign":"center","level":1} -->
        <h1 class="has-text-align-center">Welcome</h1>
        <!-- /wp:heading -->
        <!-- wp:paragraph {"align":"center"} -->
        <p class="has-text-align-center">Your tagline here.</p>
        <!-- /wp:paragraph -->
    </div>
</div>
<!-- /wp:cover -->
```

To hide a pattern from the inserter, add `Inserter: no` to the docblock.

### 2.7 Style Variations

JSON files under `styles/` that override settings and styles:

```json
{
  "$schema": "https://schemas.wp.org/trunk/theme.json",
  "version": 3,
  "title": "Dark",
  "settings": {
    "color": {
      "palette": [
        { "slug": "primary", "color": "#0d1117", "name": "Primary" },
        { "slug": "accent", "color": "#58a6ff", "name": "Accent" }
      ]
    }
  },
  "styles": {
    "color": {
      "background": "var(--wp--preset--color--primary)",
      "text": "#e6edf3"
    }
  }
}
```

Once a user selects a variation, the choice is stored in the database. Changing the JSON file will not update what the user already selected.

### 2.8 WordPress 6.9 theme.json Additions

- **Form element styling:** `styles.elements.input` and `styles.elements.select` for text inputs and selects (border, color, outline, shadow, spacing). Focus state not yet supported in 6.9.
- **Border radius presets:** `settings.border.radiusSizes` for visual selection in the border radius control.
- **Button pseudo-classes:** `:hover` and `:focus` states for Button block directly in theme.json (no custom CSS needed).

---

## Part 3: Interactivity API

### 3.1 Directives Reference

| Directive                    | Purpose                                        |
|------------------------------|------------------------------------------------|
| `data-wp-interactive`        | Declares an interactive region and namespace    |
| `data-wp-context`            | Provides per-element context (JSON)             |
| `data-wp-on--{event}`        | Attaches synchronous event handler              |
| `data-wp-on-async--{event}`  | Attaches async event handler (preferred)        |
| `data-wp-bind--{attr}`       | Binds a DOM attribute to state/context          |
| `data-wp-text`               | Sets element text content from state/context    |
| `data-wp-class--{name}`      | Toggles a CSS class based on state/context      |
| `data-wp-style--{prop}`      | Sets an inline style property                   |
| `data-wp-each`               | Iterates over an array                          |
| `data-wp-key`                | Unique key for list items                       |
| `data-wp-watch`              | Runs a callback when dependencies change        |
| `data-wp-init`               | Runs once when the element is first connected   |
| `data-wp-run`                | Runs a callback on every render                 |

### 3.2 Store, State, and Context

```js
import { store, getContext, getElement } from '@wordpress/interactivity';

const { state } = store( 'myPlugin', {
    // Global state (shared across all instances)
    state: {
        count: 0,
        get doubled() {
            return state.count * 2;
        },
    },

    // Actions (mutations)
    actions: {
        increment() {
            state.count++;
        },
        toggle() {
            const context = getContext();
            context.isOpen = ! context.isOpen;
        },
        *fetchData() {
            const { ref } = getElement();
            const response = yield fetch( state.apiUrl );
            state.items = yield response.json();
        },
    },

    // Callbacks (side effects for watch/init/run)
    callbacks: {
        logCount() {
            console.log( 'Count:', state.count );
        },
    },
} );
```

**State vs context:**
- **State** is global, shared across all instances of the block. Define with `store()`.
- **Context** is per-element, scoped to the nearest `data-wp-context` ancestor. Access with `getContext()`.

### 3.3 Server-Side Rendering (SSR)

Server-side rendering is **required** for correct behavior. The client hydrates the server-rendered markup.

**Enable directive processing in block.json:**

```json
{
  "supports": {
    "interactivity": true
  }
}
```

**Initialize state in PHP (render.php):**

```php
<?php
$items = array( 'Apple', 'Banana', 'Cherry' );

wp_interactivity_state( 'myPlugin', array(
    'items'    => $items,
    'hasItems' => count( $items ) > 0,
) );

$context = array( 'isOpen' => false );
$wrapper = get_block_wrapper_attributes();
?>
<div <?php echo $wrapper; ?>
     data-wp-interactive="myPlugin"
     <?php echo wp_interactivity_data_wp_context( $context ); ?>>

    <button data-wp-on-async--click="actions.toggle">
        Toggle List
    </button>

    <ul data-wp-bind--hidden="!context.isOpen">
        <template data-wp-each="state.items">
            <li data-wp-text="context.item"></li>
        </template>
    </ul>

    <p data-wp-bind--hidden="state.hasItems">
        <?php esc_html_e( 'No items available.', 'my-plugin' ); ?>
    </p>
</div>
```

**Derived state with closures (for dynamic server evaluation):**

```php
wp_interactivity_state( 'myPlugin', array(
    'items'    => array( 'apple', 'banana' ),
    'selected' => array( 'apple' ),
    'isSelected' => function() {
        $state   = wp_interactivity_state();
        $context = wp_interactivity_get_context();
        return in_array( $context['item'], $state['selected'] );
    },
) );
```

**For themes/plugins without block.json:**

```php
wp_interactivity_state( 'myTheme', array( 'menuOpen' => false ) );

ob_start();
?>
<nav data-wp-interactive="myTheme"
     data-wp-class--is-open="state.menuOpen">
    <button data-wp-on-async--click="actions.toggleMenu">Menu</button>
    <ul data-wp-bind--hidden="!state.menuOpen">
        <li><a href="/">Home</a></li>
    </ul>
</nav>
<?php
echo wp_interactivity_process_directives( ob_get_clean() );
```

**PHP helper functions:**

| Function                                          | Purpose                                          |
|---------------------------------------------------|--------------------------------------------------|
| `wp_interactivity_state( $ns, $state )`           | Initialize or get global state for a namespace   |
| `wp_interactivity_data_wp_context( $context )`    | Generate `data-wp-context` attribute string      |
| `wp_interactivity_get_context( $ns )`             | Get current context during directive processing  |
| `wp_interactivity_process_directives( $html )`    | Manually process directives (themes/plugins)     |
| `wp_interactivity_config( $ns, $config )`         | Set configuration data for a namespace           |

### 3.4 Hydration Rules

- Client-side JavaScript must produce markup matching the server-rendered HTML.
- Derived state defined only in JavaScript (not in PHP) causes layout shift because attributes like `hidden` are not set on initial render.
- Ensure PHP and JS derived state logic matches exactly.

### 3.5 WordPress 6.9 Interactivity Changes

- **`data-wp-ignore` is deprecated.** It broke context inheritance and client-side navigation. Avoid it; use conditional rendering or separate interactive regions instead.
- **Unique directive IDs:** Multiple directives of the same type on one element use the `---` separator:

```html
<button
  data-wp-on--click---plugin-a="actions.handleA"
  data-wp-on--click---plugin-b="actions.handleB"
>
```

- **`getServerState()` and `getServerContext()`** reset between client-side page transitions. Do not rely on stale values persisting.
- **Router regions** support `attachTo` for rendering overlays (modals, pop-ups) dynamically.
- **New TypeScript types:** `AsyncAction<ReturnType>` and `TypeYield<T>` for async action typing.

---

## Part 4: Tooling

### 4.1 @wordpress/scripts

The standard build toolchain for blocks:

```bash
# Development build with watch
npx wp-scripts start

# Production build
npx wp-scripts build

# Lint JS and CSS
npx wp-scripts lint-js
npx wp-scripts lint-style

# Run tests
npx wp-scripts test-unit-js
npx wp-scripts test-e2e
```

### 4.2 wp-env

Local WordPress development environment:

```bash
# Start environment
npx wp-env start

# Stop environment
npx wp-env stop

# Run WP-CLI commands
npx wp-env run cli wp plugin list

# Run E2E tests against the environment
npx wp-scripts test-e2e
```

### 4.3 Debugging Common Issues

**"This block contains unexpected or invalid content":**
- You changed `save()` output or attribute parsing without a deprecation entry.
- Fix: add a `deprecated` entry with the old `save` function and optionally a `migrate` function.

**Block does not appear in inserter:**
- Confirm `block.json` `name` is valid and the block is registered.
- Confirm build output exists and scripts are enqueued.
- If using PHP registration, confirm `register_block_type_from_metadata()` runs on the `init` hook.

**Attributes not saving:**
- Confirm attribute definition matches actual markup structure.
- If the value is in comment delimiter JSON, avoid brittle HTML selectors.
- Avoid the deprecated `meta` attribute source.

**Styles not applying in editor (apiVersion 3):**
- Ensure style handles are declared in block.json (`editorStyle`, `style`).
- Styles not declared in block.json will not load inside the iframed editor.

**Console warnings about apiVersion (WordPress 6.9+):**
- Update `apiVersion` to `3` in block.json. The warning only appears when `SCRIPT_DEBUG` is true.

**Interactivity directives not firing:**
- Confirm the `viewScriptModule` is enqueued and loaded (check network tab).
- Confirm the DOM element has `data-wp-interactive` with the correct namespace.
- Confirm the store namespace matches the directive values.
- Check console for JS errors before hydration.
- Confirm `supports.interactivity` is set in block.json (or `wp_interactivity_process_directives()` is called).

**Hydration mismatch / flicker:**
- Server markup differs from client expectations.
- Derived state not defined in PHP causes missing attributes on initial render.
- Ensure PHP and JS derived state logic matches.

---

## Part 5: Common Mistakes

| Mistake | Consequence | Fix |
|---------|------------|-----|
| Changing `save()` without deprecation | "Invalid block" error on existing posts | Add `deprecated` array entry with old `save` |
| Renaming block `name` in block.json | All existing instances break | Treat `name` as immutable stable API |
| Missing `useBlockProps()` in edit | Block supports (colors, spacing) not applied | Always spread `useBlockProps()` on wrapper |
| Missing `useBlockProps.save()` in save | Support classes/styles missing from saved markup | Always spread on outermost save element |
| Missing `get_block_wrapper_attributes()` in PHP render | Support classes/styles missing from frontend | Always use on wrapper in render.php |
| Using `innerHTML =` for block save | XSS risk and bypasses sanitization | Use proper React components and `RichText.Content` |
| Attribute `source` selector too brittle | Attribute value not found after minor markup change | Use stable selectors or prefer comment delimiter |
| `apiVersion` below 3 | Console warnings in 6.9; broken in 7.0 iframe editor | Set `apiVersion: 3` and test in iframe |
| Derived state only in JS, not PHP | Layout shift on initial load; `hidden` not set server-side | Define matching derived state in PHP with `wp_interactivity_state()` |
| Not declaring styles in block.json | Styles load on frontend but not in iframed editor | Add all handles to `editorStyle` / `style` fields |
| Using `data-wp-ignore` | Deprecated in 6.9; breaks context and navigation | Use conditional rendering or separate regions |
| Template parts in subdirectories | Parts not found by WordPress | Keep parts flat in `parts/` directory |
| User customizations overriding theme.json | Theme changes appear ignored | Check for DB-stored user overrides; reset if needed |
| Duplicate `InnerBlocks` in one block | Runtime error | Only one `InnerBlocks` per block |
| `templateLock: 'all'` without good reason | Users cannot modify block content | Use sparingly; prefer `false` or `'insert'` |
